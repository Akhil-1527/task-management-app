<div class="task-form-container">
  <div class="form-header">
    <h2>{{ isEditMode ? 'Edit Task' : 'Create New Task' }}</h2>
    <button class="btn btn-outline-secondary" [routerLink]="['/tasks']">
      <i class="bi bi-arrow-left"></i> Back to Tasks
    </button>
  </div>

  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
    <!-- Title field -->
    <div class="form-group">
      <label for="title">Title <span class="required">*</span></label>
      <input 
        type="text" 
        id="title" 
        formControlName="title" 
        class="form-control"
        [ngClass]="{'is-invalid': formControls['title'].touched && formControls['title'].errors}"
        placeholder="Enter task title (at least 3 characters)"
      >
      <div class="invalid-feedback" *ngIf="formControls['title'].touched && formControls['title'].errors">
        <div *ngIf="formControls['title'].errors['required']">{{ validationMessages.title.required }}</div>
        <div *ngIf="formControls['title'].errors['minlength']">{{ validationMessages.title.minlength }}</div>
      </div>
    </div>

    <!-- Description field -->
    <div class="form-group">
      <label for="description">Description <span class="required">*</span></label>
      <textarea 
        id="description" 
        formControlName="description" 
        class="form-control" 
        rows="4"
        [ngClass]="{'is-invalid': formControls['description'].touched && formControls['description'].errors}"
        placeholder="Enter task description"
      ></textarea>
      <div class="invalid-feedback" *ngIf="formControls['description'].touched && formControls['description'].errors">
        <div *ngIf="formControls['description'].errors['required']">{{ validationMessages.description.required }}</div>
      </div>
    </div>

    <!-- Due Date field -->
    <div class="form-group">
      <label for="dueDate">Due Date <span class="required">*</span></label>
      <input 
        id="dueDate" 
        type="date" 
        class="form-control" 
        formControlName="dueDate" 
        [min]="minDate" 
        [ngClass]="{'is-invalid': formControls['dueDate'].touched && formControls['dueDate'].errors}"
      >
      <small class="form-text text-muted date-hint">
        <i class="bi bi-info-circle"></i> Select today or a future date for your task.
      </small>
      <div class="invalid-feedback" *ngIf="formControls['dueDate'].touched && formControls['dueDate'].errors">
        <div *ngIf="formControls['dueDate'].errors['required']">{{ validationMessages.dueDate.required }}</div>
        <div *ngIf="formControls['dueDate'].errors['pastDate']">{{ validationMessages.dueDate.pastDate }}</div>
      </div>
    </div>

    <!-- Priority and Status in a row -->
    <div class="form-row">
      <!-- Priority field -->
      <div class="form-group">
        <label for="priority">Priority</label>
        <select id="priority" formControlName="priority" class="form-select">
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </div>

      <!-- Status field -->
      <div class="form-group">
        <label for="status">Status</label>
        <select id="status" formControlName="status" class="form-select">
          <option value="todo">To Do</option>
          <option value="in-progress">In Progress</option>
          <option value="completed">Completed</option>
        </select>
        <small *ngIf="isTaskCompleted" class="text-warning">
          <i class="bi bi-exclamation-triangle"></i> Other fields are locked because task is completed.
        </small>
      </div>
    </div>

    <!-- Auto-save indication -->
    <div *ngIf="isDirty && !isEditMode" class="auto-save-indicator">
      <i class="bi bi-cloud-check"></i> Draft automatically saved
    </div>

    <!-- Form action buttons -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" [routerLink]="['/tasks']">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="taskForm.invalid">{{ isEditMode ? 'Update Task' : 'Create Task' }}</button>
    </div>
  </form>
</div>